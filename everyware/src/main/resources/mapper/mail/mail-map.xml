<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.app.mail.mail.mapper.MailMapper">

	<select id="selectMailboxInfo" resultType="MailVO">
		SELECT sender
			  , title
			  , send_date
			  , emp_id
			  , mailbox_id
			  , FIND_CODENAME(MAILBOX_ID) mailbox_name
			  , mail_id
		FROM mail
		WHERE mailbox_id = #{mailboxId}
		ORDER BY mail_id DESC
	</select>
	
	<select id="selectMailInfo" resultType="MailVO">
		SELECT mail_id 
		      , sender
		      , title
		      , content
		      , send_date
		      , emp_id
		      , mailbox_id
		      , FIND_CODENAME(MAILBOX_ID)
		FROM mail
		WHERE mail_id = #{mailId}
	</select>
	
	<select id="selectRe" resultType="MailVO">
	 	select recipient
		from mail m
		left outer join mail_recipient r
		on m.mail_id = r.mail_id-1 
		where m.mail_id=#{mailId}
	</select>
	
	<insert id="insertMail" parameterType="MailVO">
		INSERT ALL
		   INTO mail
		       (
		       mail_id
		       , sender
		       , title
		       , content
		       , mailbox_id
		       , emp_id
		       )
		   VALUES
		       (
		           (SELECT NVL(MAX(mail_id),0)+1 mail_id
		           FROM mail)
		           , 'mi'
		           , #{title}
		           , #{content}
		           , 'd1'
		           , 100
		       )
		   INTO mail
		       (
		       mail_id
		       , sender
		       , title
		       , content
		       , mailbox_id
		       , emp_id
		       )
		   VALUES
		       (
		           (SELECT NVL(MAX(mail_id),0)+2 mail_id
		           FROM mail)
		           , 'mi'
		           , #{title}
		           , #{content}
		           , 'd2'
		           , 100
		       )
		       
		   INTO mail_recipient
		       (
		        mail_id
		        , recipient
		       )
		   VALUES
		       (
		         (SELECT NVL(MAX(mail_id),0)+2 mail_id
		        FROM mail) 
		       , #{recipient}
		       )
		SELECT * FROM dual
	</insert>
</mapper>