<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yedam.app.approval.mapper.DocMapper">
	<!-- 결재 대기 문서 -->
	<select id="waitDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE doc_type = '결재대기'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 참조/열람 대기 문서 -->
	<select id="waitRefViewDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum AS rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE doc_type = '참조열람대기'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 결재 예정 문서 -->
	<select id="expectedDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum AS rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE doc_type = '결재예정'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 기안 문서 -->
	<select id="draftDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum AS rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE doc_type = '기안'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 결재 문서 -->
	<select id="approvalDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum AS rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE doc_type = '결재'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 발송 문서 -->
	<select id="sendDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum AS rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE doc_type = '발송'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 수신 문서 -->
	<select id="receptionDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum AS rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE doc_type = '수신'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 참조/열람 문서 -->
	<select id="refViewDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum AS rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE doc_type = '참조' OR doc_type = '열람'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 참조 문서 -->
	<select id="refDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum AS rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE doc_type = '참조'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 열람 문서 -->
	<select id="viewDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum AS rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE doc_type = '열람'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 임시 문서 -->
	<select id="temporaryDocList" resultType="DocVO">
		SELECT * FROM(SELECT rownum AS rs, a.* FROM
		(SELECT *
		FROM approval_doc
		WHERE approval_status = '임시저장'
		<choose>
			<when test="dosearch != null">
				WHERE doc_title LIKE '%'||#{dosearch}||'%' OR 
					draft_emp LIKE '%'||#{dosearch}||'%' OR
					approval_task LIKE '%'||#{dosearch}||'%'
			</when>
		</choose>
		ORDER BY doc_id
		)a WHERE rownum <![CDATA[<= ]]> (#{page}) * (#{cnt})
		)WHERE rs > (#{page}-1) * (#{cnt})
	</select>
	
	<!-- 개별 문서 조회 -->
	<select id="docInfo" resultType="DocVO">
		SELECT *
		FROM approval_doc
		WHERE doc_id = #{docId}
	</select>
	
	<!-- 문서 등록(양식) -->
	<select id="newTask" resultType="TaskVO">
		SELECT approval_task
		FROM task
	</select>
	
	<!-- 문서 등록 -->
	<insert id="docInsert" parameterType="DocVO">
		<selectKey	keyProperty="docId"
					resultType="Integer"
					order="AFTER">
			SELECT doc_id_seq.CURRVAL
			FROM dual					
		</selectKey>
		INSERT INTO approval_doc
			(
				doc_id
				, doc_type
				, doc_title
				, draft_emp
				, draft_emp_dept
				, draft_date
				, approval_task
				, approval_file
				, approval_status
			)
		VALUES
			(
				doc_id_seq.NEXTVAL
				, #{docType}
				, #{docTitle}
				, #{draftEmp}
				, #{draftEmpDept}
				, sysdate
				, #{approvalTask}
				, #{approvalFile}
				, #{approvalStatus}
			)
	</insert>
	
	<!-- 문서 수정(임시 저장함) -->
	<update id="docUpdate">
		
	</update>
	
	<!-- 문서 삭제 -->
	<delete id="docDelete" parameterType="int">
		DELETE FROM approval_doc
		WHERE doc_id = #{docId}
	</delete>
	
	<!-- 리스트 개수 -->
	<select id="cntList" resultType="int">
		SELECT count(*)
		FROM approval_doc
	</select>
</mapper>